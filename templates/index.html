{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">
                    <i class="fas fa-upload"></i>
                    Cargar Archivo de Direcciones
                </h3>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <strong>Formato requerido:</strong> CSV con columnas: nombre, direccion (separadas por punto y coma)
                </div>
                
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="csvFile" class="form-label">Seleccionar archivo CSV:</label>
                        <input type="file" class="form-control" id="csvFile" name="file" accept=".csv" required>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <button type="submit" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-upload"></i>
                                Subir Archivo
                            </button>
                        </div>
                        <div class="col-md-6">
                            <button type="button" id="useLocalFile" class="btn btn-info btn-lg w-100">
                                <i class="fas fa-file"></i>
                                Usar Archivo Local (30 direcciones)
                            </button>
                            <small class="text-muted mt-1 d-block">Procesamiento rápido para pruebas</small>
                        </div>
                    </div>
                </form>

                <div id="uploadStatus" class="mt-3" style="display: none;">
                    <div class="alert" id="statusMessage"></div>
                </div>

                <div id="optimizeSection" class="mt-4" style="display: none;">
                    <hr>
                    <h4>Parámetros de Optimización</h4>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <h6><i class="fas fa-warehouse"></i> Depot Central</h6>
                            <small class="text-muted">Carrera 7 #32-18, Centro</small>
                            <p class="small text-info mt-1">Punto de partida y llegada para todos los camiones</p>
                        </div>
                        <div class="col-md-6">
                            <label for="truckCount" class="form-label">
                                <i class="fas fa-truck"></i> Número de Camiones
                            </label>
                            <select id="truckCount" class="form-select">
                                <option value="3" selected>3 Camiones</option>
                                <option value="4">4 Camiones</option>
                                <option value="5">5 Camiones</option>
                                <option value="6">6 Camiones</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="alert alert-success">
                        <h6 class="mb-2">
                            <i class="fas fa-info-circle"></i> Optimización Geográfica
                        </h6>
                        <p class="mb-0 small">
                            El algoritmo optimizará las rutas basándose únicamente en la proximidad geográfica, 
                            distribuyendo las direcciones entre los camiones para minimizar las distancias totales.
                        </p>
                    </div>

                    <button id="optimizeBtn" class="btn btn-primary btn-lg w-100">
                        <i class="fas fa-route"></i>
                        Optimizar Rutas
                    </button>
                </div>

                <div id="loadingSection" class="text-center mt-4" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Procesando...</span>
                    </div>
                    <p class="mt-2">Optimizando rutas, por favor espere...</p>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Instrucciones</h5>
            </div>
            <div class="card-body">
                <ol>
                    <li>Prepare un archivo CSV con direcciones de Bogotá</li>
                    <li>Formato: nombre;direccion (separadas por punto y coma)</li>
                    <li>Suba el archivo o use el archivo local de ejemplo (30 direcciones reales)</li>
                    <li>Seleccione el número de camiones (3-6)</li>
                    <li>Haga clic en "Optimizar Rutas" para procesar</li>
                    <li>Visualice los resultados en el mapa interactivo</li>
                </ol>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/upload.js') }}"></script>
{% endblock %}